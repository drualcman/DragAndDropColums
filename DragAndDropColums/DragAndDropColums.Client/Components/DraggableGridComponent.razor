<div class="grid-controls">
    <button @onclick="AddNewItem" class="btn btn-primary">➕ Agregar Elemento</button>
    <button @onclick="ResetGrid" class="btn btn-secondary">🔄 Reiniciar</button>
    <div class="grid-info">
        <label>Columnas:</label>
        <input type="range" min="4" max="12" @bind="Layout.Columns" @bind:event="oninput" />
        <span>@Layout.Columns</span>

        <label>Filas:</label>
        <input type="range" min="4" max="20" @bind="Layout.Rows" @bind:event="oninput" />
        <span>@Layout.Rows</span>

        <button @onclick="SaveLayout" class="btn btn-success">💾 Guardar</button>
    </div>

    @if (_selectedItem != null)
    {
        <div class="selected-item-info">
            <strong>Seleccionado:</strong>
            <span class="selected-item-details">
                (@_selectedItem.Column,@_selectedItem.Row) - Tamaño: @_selectedItem.ColumnSpan×@_selectedItem.RowSpan
            </span>
            <button @onclick="@(() => RemoveItem(_selectedItem))" class="btn-danger">🗑️ Eliminar</button>
        </div>
    }
</div>

<div class="grid-instructions">
    <div>
        <p>🎯 <strong>Instrucciones:</strong></p>
        <ul>
            <li>🖱️ <strong>Click</strong> para seleccionar un elemento (borde azul)</li>
            <li>🖱️ <strong>Click y arrastra</strong> para mover elementos (borde rojo punteado)</li>
            <li>⬅️➡️⬆️⬇️ Usa <strong>flechas del teclado</strong> para mover el seleccionado</li>
            <li>❌ Usa <strong>Delete</strong> para eliminar el elemento seleccionado</li>
            <li>ESC para deseleccionar, ESPACIO para alternar selección</li>
        </ul>
    </div>
    @if (_selectedItem != null)
    {
        <div class="movement-controls">
            <h4>📦 Control del Elemento Seleccionado:</h4>
            <div class="movement-buttons">
                <button @onclick="@(() => MoveSelectedItem(0, -1))" class="btn-move">⬆️ Arriba</button>
                <button @onclick="@(() => MoveSelectedItem(-1, 0))" class="btn-move">⬅️ Izquierda</button>
                <button @onclick="@(() => MoveSelectedItem(1, 0))" class="btn-move">➡️ Derecha</button>
                <button @onclick="@(() => MoveSelectedItem(0, 1))" class="btn-move">⬇️ Abajo</button>
            </div>
            <div class="resize-buttons">
                <button @onclick="@(() => ResizeItemWidth(_selectedItem, 1))" class="btn-resize">➕ Ancho</button>
                <button @onclick="@(() => ResizeItemWidth(_selectedItem, -1))" class="btn-resize">➖ Ancho</button>
                <button @onclick="@(() => ResizeItemHeight(_selectedItem, 1))" class="btn-resize">➕ Alto</button>
                <button @onclick="@(() => ResizeItemHeight(_selectedItem, -1))" class="btn-resize">➖ Alto</button>
            </div>
        </div>
    }
</div>

<!-- Grid Visualization Component -->
<GridVisualization @ref="_gridVisualization" TData=object
                   Layout="Layout"
                   SelectedItem="_selectedItem"
                   SelectedItemChanged="OnSelectedItemChanged"
                   LayoutChanged="OnLayoutChanged"
                   OnItemRemoved="RemoveItem" >
               <p>@context</p>
</GridVisualization>

<!-- Editor de propiedades -->
@if (_selectedItem != null)
{
    <div class="item-editor">
        <h4>✏️ Editar Elemento</h4>
        <div class="editor-grid">
            <div class="editor-section">
                <label>Ancho (columnas):</label>
                <input type="range" min="1" max="@Layout.Columns"
                       @bind="_selectedItem.ColumnSpan" @bind:event="oninput" />
                <span>@_selectedItem.ColumnSpan</span>
            </div>

            <div class="editor-section">
                <label>Alto (filas):</label>
                <input type="range" min="1" max="@Layout.Rows"
                       @bind="_selectedItem.RowSpan" @bind:event="oninput" />
                <span>@_selectedItem.RowSpan</span>
            </div>
        </div>

        <div class="editor-actions">
            <button @onclick="CloseEditor" class="btn btn-primary">✅ Aplicar</button>
            <button @onclick="DeselectItem" class="btn btn-secondary">❌ Cancelar</button>
        </div>
    </div>
}